generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model Application {
  id                 String   @id @default(auto()) @map("_id") @db.ObjectId

  applicantId        String   @unique
  applicant          String
  applicationDate    DateTime
  phoneNumber        String?
  emailId            String?
  sourceAt           String
  subject            String
  block              String

  // ORIGINAL PDF — NEVER CHANGES AFTER CREATION
  originalAttachment       String?
  originalAttachmentPublicId String?

  // CURRENT PDF (changes during workflow) — for timeline
  attachment               String?
  attachmentPublicId       String?

  concernedOfficer         String?  @default("N/A")
  department               String?
  supervisor               String?
  supervisorDepartment     String?

  status                   String   @default("Not Assigned Yet")

  timeline                 TimelineEntry[]
  createdAt                DateTime @default(now())
  updatedAt                DateTime @updatedAt

  @@index([applicant])
  @@index([applicationDate])
  @@index([block])
  @@index([status])
  @@index([concernedOfficer])
  @@index([supervisor])
}

// ─────────────────────────────────────
// ADMIN MODEL 
// ─────────────────────────────────────
model Admin {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId
  adminId      String   @unique
  password     String
  name         String?
  position     String?
  department   String?
  role         String   // e.g., "Super Admin", "Data Entry", "Officer"
  refreshToken String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@map("AdminsDetails")
}

// ─────────────────────────────────────
// NEW: PROFESSIONAL SUPERVISOR MODEL
// ─────────────────────────────────────
model Supervisor {                   
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  supervisorId  String   @unique
  password      String
  name          String
  designation   String?
  department    String
  phone         String?
  email         String?
  block         String?
  isActive      Boolean  @default(true)
  role          String   @default("Supervisor")
  refreshToken  String?

  // FIX: Allow null for existing bad data + auto-fix on read
  createdAt     DateTime? @default(now())
  updatedAt     DateTime? @updatedAt

  @@map("SupervisorsDetails")
}

// Embedded Timeline Entry
type TimelineEntry {
  section     String
  comment     String
  date        String
  pdfLink     String?
  department  String?
  officer     String?
  supervisor  String?
}